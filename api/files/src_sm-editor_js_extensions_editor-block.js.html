<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/sm-editor/js/extensions/editor-block.js - SmugMug YUI Gallery API docs</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="SmugMug YUI Gallery API docs"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 3.11.0-git</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/DragDrop.html">DragDrop</a></li>
            
                <li><a href="../classes/Editor.html">Editor</a></li>
            
                <li><a href="../classes/Editor.Base.html">Editor.Base</a></li>
            
                <li><a href="../classes/Editor.Block.html">Editor.Block</a></li>
            
                <li><a href="../classes/Editor.Delete.html">Editor.Delete</a></li>
            
                <li><a href="../classes/Editor.DOM.html">Editor.DOM</a></li>
            
                <li><a href="../classes/Editor.Format.html">Editor.Format</a></li>
            
                <li><a href="../classes/Editor.Keys.html">Editor.Keys</a></li>
            
                <li><a href="../classes/Editor.Link.html">Editor.Link</a></li>
            
                <li><a href="../classes/Editor.Queue.html">Editor.Queue</a></li>
            
                <li><a href="../classes/Editor.Style.html">Editor.Style</a></li>
            
                <li><a href="../classes/Editor.Undo.html">Editor.Undo</a></li>
            
                <li><a href="../classes/IndexedMap.html">IndexedMap</a></li>
            
                <li><a href="../classes/Map.html">Map</a></li>
            
                <li><a href="../classes/Menu.html">Menu</a></li>
            
                <li><a href="../classes/Menu.Base.html">Menu.Base</a></li>
            
                <li><a href="../classes/Menu.Item.html">Menu.Item</a></li>
            
                <li><a href="../classes/Menu.Templates.html">Menu.Templates</a></li>
            
                <li><a href="../classes/Plugin.DragDrop.Reorder.html">Plugin.DragDrop.Reorder</a></li>
            
                <li><a href="../classes/Plugin.FocusManager.html">Plugin.FocusManager</a></li>
            
                <li><a href="../classes/Plugin.Menu.html">Plugin.Menu</a></li>
            
                <li><a href="../classes/Promise.EventNotifier.html">Promise.EventNotifier</a></li>
            
                <li><a href="../classes/Range.html">Range</a></li>
            
                <li><a href="../classes/Selection.html">Selection</a></li>
            
                <li><a href="../classes/TreeView.html">TreeView</a></li>
            
                <li><a href="../classes/TreeView.Sortable.html">TreeView.Sortable</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/dom-form-values.html">dom-form-values</a></li>
            
                <li><a href="../modules/gallery-sm-dragdrop.html">gallery-sm-dragdrop</a></li>
            
                <li><a href="../modules/gallery-sm-dragdrop-reorder.html">gallery-sm-dragdrop-reorder</a></li>
            
                <li><a href="../modules/gallery-sm-editor.html">gallery-sm-editor</a></li>
            
                <li><a href="../modules/gallery-sm-editor-base.html">gallery-sm-editor-base</a></li>
            
                <li><a href="../modules/gallery-sm-editor-block.html">gallery-sm-editor-block</a></li>
            
                <li><a href="../modules/gallery-sm-editor-delete.html">gallery-sm-editor-delete</a></li>
            
                <li><a href="../modules/gallery-sm-editor-dom.html">gallery-sm-editor-dom</a></li>
            
                <li><a href="../modules/gallery-sm-editor-format.html">gallery-sm-editor-format</a></li>
            
                <li><a href="../modules/gallery-sm-editor-keys.html">gallery-sm-editor-keys</a></li>
            
                <li><a href="../modules/gallery-sm-editor-link.html">gallery-sm-editor-link</a></li>
            
                <li><a href="../modules/gallery-sm-editor-queue.html">gallery-sm-editor-queue</a></li>
            
                <li><a href="../modules/gallery-sm-editor-style.html">gallery-sm-editor-style</a></li>
            
                <li><a href="../modules/gallery-sm-focusmanager.html">gallery-sm-focusmanager</a></li>
            
                <li><a href="../modules/gallery-sm-indexed-map.html">gallery-sm-indexed-map</a></li>
            
                <li><a href="../modules/gallery-sm-map.html">gallery-sm-map</a></li>
            
                <li><a href="../modules/gallery-sm-menu.html">gallery-sm-menu</a></li>
            
                <li><a href="../modules/gallery-sm-menu-base.html">gallery-sm-menu-base</a></li>
            
                <li><a href="../modules/gallery-sm-menu-item.html">gallery-sm-menu-item</a></li>
            
                <li><a href="../modules/gallery-sm-menu-plugin.html">gallery-sm-menu-plugin</a></li>
            
                <li><a href="../modules/gallery-sm-menu-templates.html">gallery-sm-menu-templates</a></li>
            
                <li><a href="../modules/gallery-sm-promise-events.html">gallery-sm-promise-events</a></li>
            
                <li><a href="../modules/gallery-sm-range.html">gallery-sm-range</a></li>
            
                <li><a href="../modules/gallery-sm-selection.html">gallery-sm-selection</a></li>
            
                <li><a href="../modules/gallery-sm-treeview.html">gallery-sm-treeview</a></li>
            
                <li><a href="../modules/gallery-sm-treeview-sortable.html">gallery-sm-treeview-sortable</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/sm-editor/js/extensions/editor-block.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*jshint expr:true, onevar:false */

/**
Provides the &#x60;Editor.Block&#x60; extension.

@module gallery-sm-editor
@submodule gallery-sm-editor-block
**/

/**
Extension for &#x60;Editor.Base&#x60; that handles block element formatting

Provides support for the following commands:

- formatBlock
- heading
- insertParagraph

@class Editor.Block
@extends Base
@extensionfor Editor.Base
**/

(function () {

var EDOM = Y.Editor.DOM;

var EditorBlock = Y.Base.create(&#x27;editorBlock&#x27;, Y.Base, [], {
    // -- Public Properties ----------------------------------------------------

    /**
    Hash of block commands supported by this editor.

    Names should correspond with valid &#x60;execCommand()&#x60; command names. Values
    are properties in the following format:

    @property {Object} blockCommands
        @param {Function|String} commandFn
        @param {Function|String} [queryFn]
    **/
    blockCommands: {
        formatBlock: {
            commandFn: &#x27;_formatBlock&#x27;,
            queryFn: &#x27;_queryBlockCommand&#x27;
        },

        heading: {
            commandFn: &#x27;_formatBlock&#x27;,
            queryFn: &#x27;_queryBlockCommand&#x27;
        },

        insertBreak: {
            commandFn: &#x27;_noCommand&#x27;
        },

        insertParagraph: {
            commandFn: &#x27;_insertReturn&#x27;,
            queryFn: &#x27;_queryBlockCommand&#x27;
        }
    },


    /**
    Key commands related to block functionality.

    @property {Object} styleKeyCommands
    **/
    blockKeyCommands: {
        &#x27;alt+c&#x27;:       &#x27;justifyCenter&#x27;,
        &#x27;alt+f&#x27;:       &#x27;justifyFull&#x27;,
        &#x27;alt+l&#x27;:       &#x27;justifyLeft&#x27;,
        &#x27;alt+r&#x27;:       &#x27;justifyRight&#x27;,
        &#x27;enter&#x27;:       &#x27;insertParagraph&#x27;,
        // ctrl+enter for safari, shift+enter for sane browsers. safe to have
        // both declarations here because they pass through to default behavior
        &#x27;ctrl+enter&#x27;:  {fn: &#x27;insertBreak&#x27;, allowDefault: true, async: true},
        &#x27;shift+enter&#x27;: {fn: &#x27;insertBreak&#x27;, allowDefault: true, async: true}
    },


    /**
    HTML tags supported by this editor. Unsupported tags will be treated
    as text

    @property {String} blockTags
    **/
    blockTags: &#x27;div, p, h1, h2, h3, h4, h5&#x27;,


    // -- Lifecycle ------------------------------------------------------------

    initializer: function () {
        this.commands = Y.merge(this.commands, this.blockCommands);

        if (this.supportedTags) {
            this.supportedTags += &#x27;,&#x27; + this.blockTags;
        } else {
            this.supportedTags = this.blockTags;
        }

        if (this.keyCommands) {
            this.keyCommands = Y.merge(this.keyCommands, this.blockKeyCommands);
        }

        this._attachBlockEvents();
    },


    destructor: function () {
        this._detachBlockEvents();
    },


    // -- Protected Methods ----------------------------------------------------

    /**
    Attaches block events.

    @method _attachBlockEvents
    @protected
    **/
    _attachBlockEvents: function () {
        if (this._blockEvents) {
            return;
        }

        this._blockEvents = [
            this.on(&#x27;selectionChange&#x27;, this._blockOnSelectionChange, this)
        ];
    },


    /**
    Detaches block events.

    @method _detachBlockEvents
    @protected
    **/
    _detachBlockEvents: function () {
        if (this._blockEvents) {
            new Y.EventHandle(this._blockEvents).detach();
            this._blockEvents = null;
        }
    },


    /**
    Replaces block elements containing the current selection with elements
    of the given &#x60;tag&#x60;

    @method _formatBlock
    @param {String} tag The new block element tag
    @protected
    **/
    _formatBlock: function (tag) {
        tag = tag.replace(/[&lt;&gt;]/g, &#x27;&#x27;);

        if (-1 &lt; this.blockTags.indexOf(tag)) {
            tag = &#x27;&lt;&#x27; + tag + &#x27;&gt;&#x27;;

            var selection = this.selection,
                range = selection.range(),
                nodes = [];

            this._getNodes(range, this.blockTags).each(function (node) {
                var newNode = Y.Node.create(tag);

                newNode.insert(node.get(&#x27;childNodes&#x27;));

                EDOM.copyStyles(node, newNode, this.supportedStyles, {
                    explicit: true,
                    overwrite: false
                });

                node.replace(newNode).remove(true);

                nodes.push(newNode);
            }, this);

            // hack until bookmarks are implemented to preserve range
            range.startNode(nodes[0]);
            range.endNode(nodes[nodes.length]);

            range.shrink().collapse({toStart: true});

            selection.select(range);
        }
    },


    /**
    Inserts a &#x60;return&#x60; at the current selection point.

    Any content contained by the range is deleted, resulting in a collapsed range.

    If the range is at the start of a block, a duplicate, empty block is
    inserted as the previous sibling of current block. The range is positioned
    at the beginning of the new block

    If the range is at the end of a block, a new &#x60;&lt;p&gt;&#x60; element is created as
    the next sibling of the current block. The range is positioned at the start
    of the new block.

    If the range is in the middle of a block, the block will be split at the
    current position. The range will be positioned at the beginning of the new
    block.

    @method _insertReturn
    @protected
    **/
    _insertReturn: function () {
        var selection = this.selection,
            range = selection.range().shrink(),
            block, startRange, endRange;

        range.deleteContents();

        // the range will be collapsed after deleteContents, so
        // there will only ever be one &#x27;block&#x27;
        block = this._getNodes(range, this.blockTags).item(0);

        // when hitting enter in an &#x60;empty&#x60; block, collapse the
        // the range to the end of the block to force the new block
        // to be inserted after
        if (&#x27;&#x27; === block.get(&#x27;text&#x27;)) {
            range.selectNodeContents(block).collapse();
        }

        range.expand({stopAt: block});
        startRange = range.clone().selectNodeContents(block).collapse({toStart: true});
        endRange = range.clone().selectNodeContents(block).collapse();

        if (0 === range.compare(startRange, {myPoint: &#x27;start&#x27;, otherPoint: &#x27;start&#x27;})) {
            // the range is collapsed at the start of the block, insert
            // a clone of the block before the current block
            block = block.insert(block.cloneNode(), &#x27;before&#x27;).previous();
        } else if (0 === range.compare(endRange, {myPoint: &#x27;end&#x27;, otherPoint: &#x27;end&#x27;})) {
            // the range is collapsed at the end of the block, start a new
            // paragraph after the current block
            block = block.insert(&#x27;&lt;p&gt;&lt;/p&gt;&#x27;, &#x27;after&#x27;).next();
        } else {
            // somewhere in the middle of a block node, split it
            block = this._splitRange(range, this.blockTags);
        }

        // in order to be able to place the cursor inside an element
        // in webkit we need to insert a br
        if (EDOM.isEmptyNode(block)) {
            block.setHTML(&#x27;&lt;br&gt;&#x27;);
        }

        range.selectNodeContents(block).collapse({toStart: true});

        selection.select(range);
    },


    /**
    Default query function for block elements

    @method _queryBlockCommand
    @return {NodeList} A nodelist of the block nodes containing the range
    @protected
     */
    _queryBlockCommand: function() {
        return this._getNodes(this.selection.range(), this.blockTags);
    },


    /**
    Splits elements after the given range until a node matching the
    given &#x60;selector&#x60; is reached.

    @method _splitRange
    @param {Range} range
    @param {String} selector
    @return {Node} The node created after splitting
    @protected
    **/
    _splitRange: function (range, selector) {
        var endNode, endOffset;

        endNode = range.endNode();
        endOffset = range.endOffset();

        while (!endNode.test(selector)) {
            endOffset = EDOM.split(endNode, endOffset);
            endNode = endOffset.get(&#x27;parentNode&#x27;);
        }

        if (this._inputNode !== endNode) {
            endOffset = EDOM.split(endNode, endOffset);
            endNode = endOffset.get(&#x27;parentNode&#x27;);
        }

        if (!endOffset._node) {
            endOffset = endNode.get(&#x27;childNodes&#x27;).item(endOffset);
        }

        return endOffset;
    },


    // -- Protected Event Handlers ---------------------------------------------

    /**
    Event handler for the selection &#x60;change&#x60; event

    Creates a default &#x60;block&#x60; if none exists for the current selection

    @method _blockOnSelectionChange
    @param {EventFacade} e
    @protected
    **/
    _blockOnSelectionChange: function (e) {
        var range = e.range,
            startNode;

        if (!range || !range.isCollapsed()) {
            return;
        }

        startNode = range.startNode();

        if (this._inputNode === startNode.ancestor(this.blockTags, true)) {
            Y.Editor.Base.prototype._execCommand.call(this, &#x27;formatBlock&#x27;, &#x27;&lt;p&gt;&#x27;);
        }
    }
});

Y.namespace(&#x27;Editor&#x27;).Block = EditorBlock;

}());

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
