<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/sm-editor/js/extensions/editor-link.js - SmugMug YUI Gallery API docs</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="SmugMug YUI Gallery API docs"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 3.11.0-git</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/DragDrop.html">DragDrop</a></li>
            
                <li><a href="../classes/Editor.html">Editor</a></li>
            
                <li><a href="../classes/Editor.Base.html">Editor.Base</a></li>
            
                <li><a href="../classes/Editor.Block.html">Editor.Block</a></li>
            
                <li><a href="../classes/Editor.Delete.html">Editor.Delete</a></li>
            
                <li><a href="../classes/Editor.DOM.html">Editor.DOM</a></li>
            
                <li><a href="../classes/Editor.Format.html">Editor.Format</a></li>
            
                <li><a href="../classes/Editor.Keys.html">Editor.Keys</a></li>
            
                <li><a href="../classes/Editor.Link.html">Editor.Link</a></li>
            
                <li><a href="../classes/Editor.Queue.html">Editor.Queue</a></li>
            
                <li><a href="../classes/Editor.Style.html">Editor.Style</a></li>
            
                <li><a href="../classes/Editor.Undo.html">Editor.Undo</a></li>
            
                <li><a href="../classes/IndexedMap.html">IndexedMap</a></li>
            
                <li><a href="../classes/Map.html">Map</a></li>
            
                <li><a href="../classes/Menu.html">Menu</a></li>
            
                <li><a href="../classes/Menu.Base.html">Menu.Base</a></li>
            
                <li><a href="../classes/Menu.Item.html">Menu.Item</a></li>
            
                <li><a href="../classes/Menu.Templates.html">Menu.Templates</a></li>
            
                <li><a href="../classes/Plugin.DragDrop.Reorder.html">Plugin.DragDrop.Reorder</a></li>
            
                <li><a href="../classes/Plugin.FocusManager.html">Plugin.FocusManager</a></li>
            
                <li><a href="../classes/Plugin.Menu.html">Plugin.Menu</a></li>
            
                <li><a href="../classes/Promise.EventNotifier.html">Promise.EventNotifier</a></li>
            
                <li><a href="../classes/Range.html">Range</a></li>
            
                <li><a href="../classes/Selection.html">Selection</a></li>
            
                <li><a href="../classes/TreeView.html">TreeView</a></li>
            
                <li><a href="../classes/TreeView.Sortable.html">TreeView.Sortable</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/dom-form-values.html">dom-form-values</a></li>
            
                <li><a href="../modules/gallery-sm-dragdrop.html">gallery-sm-dragdrop</a></li>
            
                <li><a href="../modules/gallery-sm-dragdrop-reorder.html">gallery-sm-dragdrop-reorder</a></li>
            
                <li><a href="../modules/gallery-sm-editor.html">gallery-sm-editor</a></li>
            
                <li><a href="../modules/gallery-sm-editor-base.html">gallery-sm-editor-base</a></li>
            
                <li><a href="../modules/gallery-sm-editor-block.html">gallery-sm-editor-block</a></li>
            
                <li><a href="../modules/gallery-sm-editor-delete.html">gallery-sm-editor-delete</a></li>
            
                <li><a href="../modules/gallery-sm-editor-dom.html">gallery-sm-editor-dom</a></li>
            
                <li><a href="../modules/gallery-sm-editor-format.html">gallery-sm-editor-format</a></li>
            
                <li><a href="../modules/gallery-sm-editor-keys.html">gallery-sm-editor-keys</a></li>
            
                <li><a href="../modules/gallery-sm-editor-link.html">gallery-sm-editor-link</a></li>
            
                <li><a href="../modules/gallery-sm-editor-queue.html">gallery-sm-editor-queue</a></li>
            
                <li><a href="../modules/gallery-sm-editor-style.html">gallery-sm-editor-style</a></li>
            
                <li><a href="../modules/gallery-sm-focusmanager.html">gallery-sm-focusmanager</a></li>
            
                <li><a href="../modules/gallery-sm-indexed-map.html">gallery-sm-indexed-map</a></li>
            
                <li><a href="../modules/gallery-sm-map.html">gallery-sm-map</a></li>
            
                <li><a href="../modules/gallery-sm-menu.html">gallery-sm-menu</a></li>
            
                <li><a href="../modules/gallery-sm-menu-base.html">gallery-sm-menu-base</a></li>
            
                <li><a href="../modules/gallery-sm-menu-item.html">gallery-sm-menu-item</a></li>
            
                <li><a href="../modules/gallery-sm-menu-plugin.html">gallery-sm-menu-plugin</a></li>
            
                <li><a href="../modules/gallery-sm-menu-templates.html">gallery-sm-menu-templates</a></li>
            
                <li><a href="../modules/gallery-sm-promise-events.html">gallery-sm-promise-events</a></li>
            
                <li><a href="../modules/gallery-sm-range.html">gallery-sm-range</a></li>
            
                <li><a href="../modules/gallery-sm-selection.html">gallery-sm-selection</a></li>
            
                <li><a href="../modules/gallery-sm-treeview.html">gallery-sm-treeview</a></li>
            
                <li><a href="../modules/gallery-sm-treeview-sortable.html">gallery-sm-treeview-sortable</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/sm-editor/js/extensions/editor-link.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*jshint expr:true, onevar:false */

/**
Provides the &#x60;Editor.Link&#x60; extension.

@module gallery-sm-editor
@submodule gallery-sm-editor-link
**/

/**
Extension for &#x60;Editor.Base&#x60; that enables inserting links

Provides support for the following commands:

- createLink
- unlink

@class Editor.Link
@extends Base
@extensionfor Editor.Base
**/

(function() {
var EditorLink = Y.Base.create(&#x27;editorLink&#x27;, Y.Base, [], {
    // -- Public Properties ----------------------------------------------------

    /**
    Hash of link commands supported by this editor.

    Names should correspond with valid &#x60;execCommand()&#x60; command names. Values
    are properties in the following format:

    @property {Object} linkCommands
        @param {Function|String} commandFn
        @param {Function|String} [queryFn]
    **/
    linkCommands: {
        createLink: {
            commandFn: &#x27;_createLink&#x27;,
            queryFn:   &#x27;isLink&#x27;
        },

        unlink: {
            commandFn: &#x27;_unlink&#x27;,
            queryFn:   &#x27;isLink&#x27;
        }
    },

    /**
    HTML tags supported by this editor. Unsupported tags will be treated
    as text

    @property {String} supportedTags
    **/
    linkTags: &#x27;a&#x27;,

    /**
    HTML Template for building an anchor node

    @property {Object} linkTemplate
    **/
    linkTemplate: &#x27;&lt;a href=&quot;{href}&quot; target=&quot;{target}&quot;&gt;&lt;/a&gt;&#x27;,


    // -- Lifecycle ------------------------------------------------------------

    initializer: function () {
        this.commands = Y.merge(this.commands, this.linkCommands);

        if (this.supportedTags) {
            this.supportedTags += &#x27;,&#x27; + this.linkTags;
        } else {
            this.supportedTags = this.linkTags;
        }
    },


    // -- Public Methods -------------------------------------------------------

    /**
    Returns whether or not the current range is entirely in an anchor element

    @method isLink
    @return {boolean} &#x60;true&#x60; if the range is contained in an anchor element,
      &#x60;false&#x60; otherwise
    **/
    isLink: function () {
        return !!this._getAnchorNode();
    },


    // -- Protected Methods ----------------------------------------------------

    /**
    Returns the nearest ancestor anchor that entirely contains
    the current range

    @method _getAnchorNode
    @return {Node} The containing anchor element
    @protected
    **/
    _getAnchorNode: function() {
        this.focus();

        var parentNode = this.selection.range().shrink().parentNode();

        return parentNode.ancestor(this.linkTags, true);
    },


    /**
    Implementation for the &#x60;createLink&#x60; command

    Wraps the currently selected range in an anchor &#x60;&lt;a&gt;&#x60; tag

    @method _createLink
    @param {Object} options
        @param {String} options.href
        @param {String} [options.target=_self]
        @param {String} [options.text]
    @protected
    **/
    _createLink: function(options){
        var range = this.selection.range(),
            anchorNode, styleNodes;

        if (!range) {
            return;
        }

        if (this.isLink()) {
            this._unlink();
            range = this.selection.range();
        }

        options || (options = {});
        options.href = encodeURI(options.href || &#x27;&#x27;);
        options.target = encodeURIComponent(options.target || &#x27;_self&#x27;);

        anchorNode = Y.Node.create(Y.Lang.sub(this.linkTemplate, options));
        styleNodes = this._getStyleNodes(range);

        anchorNode.append(styleNodes);

        range.insertNode(anchorNode);

        if (options.text &amp;&amp; options.text !== range.toString()) {
            var firstChild = anchorNode.get(&#x27;firstChild&#x27;);

            if (this._isStyleNode(firstChild)) {
                firstChild.set(&#x27;text&#x27;, options.text);
                anchorNode.setHTML(firstChild);
            } else {
                anchorNode.set(&#x27;text&#x27;, options.text);
            }
        }

        range.selectNode(anchorNode).collapse();

        this.selection.select(range);
    },


    /**
    Removes link by replacing the anchor element with the child nodes
    of the anchor

    The anchor element will be removed from the DOM and destroyed.

    @method _unlink
    @protected
    **/
    _unlink: function() {
        var selection = this.selection,
            anchorNode;

        // we can use the native unlink command once we have bookmarking
        // in place, but firefox selects adjacent text nodes after unlink

        if (anchorNode = this._getAnchorNode()) {
            var firstChild = anchorNode.get(&#x27;firstChild&#x27;),
                lastChild = anchorNode.get(&#x27;lastChild&#x27;),
                range = selection.range();

            // only need to unwrap one of the children to unwrap the
            // whole anchorNode
            firstChild.unwrap();

            anchorNode.destroy();

            range.startNode(firstChild, 0);
            range.endNode(lastChild, &#x27;after&#x27;);

            selection.select(range.shrink({trim: true}));
        }
    }
});

Y.namespace(&#x27;Editor&#x27;).Link = EditorLink;

}());

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
