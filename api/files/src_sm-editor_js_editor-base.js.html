<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/sm-editor/js/editor-base.js - SmugMug YUI Gallery API docs</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="SmugMug YUI Gallery API docs"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 3.11.0-git</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/DragDrop.html">DragDrop</a></li>
            
                <li><a href="../classes/Editor.html">Editor</a></li>
            
                <li><a href="../classes/Editor.Base.html">Editor.Base</a></li>
            
                <li><a href="../classes/Editor.DOM.html">Editor.DOM</a></li>
            
                <li><a href="../classes/Editor.Keys.html">Editor.Keys</a></li>
            
                <li><a href="../classes/Editor.Link.html">Editor.Link</a></li>
            
                <li><a href="../classes/Editor.Queue.html">Editor.Queue</a></li>
            
                <li><a href="../classes/Editor.Style.html">Editor.Style</a></li>
            
                <li><a href="../classes/Editor.Undo.html">Editor.Undo</a></li>
            
                <li><a href="../classes/Map.html">Map</a></li>
            
                <li><a href="../classes/Menu.html">Menu</a></li>
            
                <li><a href="../classes/Menu.Base.html">Menu.Base</a></li>
            
                <li><a href="../classes/Menu.Item.html">Menu.Item</a></li>
            
                <li><a href="../classes/Menu.Templates.html">Menu.Templates</a></li>
            
                <li><a href="../classes/Plugin.DragDrop.Reorder.html">Plugin.DragDrop.Reorder</a></li>
            
                <li><a href="../classes/Plugin.FocusManager.html">Plugin.FocusManager</a></li>
            
                <li><a href="../classes/Plugin.Menu.html">Plugin.Menu</a></li>
            
                <li><a href="../classes/Promise.EventNotifier.html">Promise.EventNotifier</a></li>
            
                <li><a href="../classes/Range.html">Range</a></li>
            
                <li><a href="../classes/Selection.html">Selection</a></li>
            
                <li><a href="../classes/TreeView.html">TreeView</a></li>
            
                <li><a href="../classes/TreeView.Sortable.html">TreeView.Sortable</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/dom-form-values.html">dom-form-values</a></li>
            
                <li><a href="../modules/gallery-sm-dragdrop.html">gallery-sm-dragdrop</a></li>
            
                <li><a href="../modules/gallery-sm-dragdrop-reorder.html">gallery-sm-dragdrop-reorder</a></li>
            
                <li><a href="../modules/gallery-sm-editor.html">gallery-sm-editor</a></li>
            
                <li><a href="../modules/gallery-sm-editor-base.html">gallery-sm-editor-base</a></li>
            
                <li><a href="../modules/gallery-sm-editor-dom.html">gallery-sm-editor-dom</a></li>
            
                <li><a href="../modules/gallery-sm-editor-keys.html">gallery-sm-editor-keys</a></li>
            
                <li><a href="../modules/gallery-sm-editor-link.html">gallery-sm-editor-link</a></li>
            
                <li><a href="../modules/gallery-sm-editor-queue.html">gallery-sm-editor-queue</a></li>
            
                <li><a href="../modules/gallery-sm-editor-style.html">gallery-sm-editor-style</a></li>
            
                <li><a href="../modules/gallery-sm-editor-undo.html">gallery-sm-editor-undo</a></li>
            
                <li><a href="../modules/gallery-sm-focusmanager.html">gallery-sm-focusmanager</a></li>
            
                <li><a href="../modules/gallery-sm-map.html">gallery-sm-map</a></li>
            
                <li><a href="../modules/gallery-sm-menu.html">gallery-sm-menu</a></li>
            
                <li><a href="../modules/gallery-sm-menu-base.html">gallery-sm-menu-base</a></li>
            
                <li><a href="../modules/gallery-sm-menu-item.html">gallery-sm-menu-item</a></li>
            
                <li><a href="../modules/gallery-sm-menu-plugin.html">gallery-sm-menu-plugin</a></li>
            
                <li><a href="../modules/gallery-sm-menu-templates.html">gallery-sm-menu-templates</a></li>
            
                <li><a href="../modules/gallery-sm-promise-events.html">gallery-sm-promise-events</a></li>
            
                <li><a href="../modules/gallery-sm-range.html">gallery-sm-range</a></li>
            
                <li><a href="../modules/gallery-sm-selection.html">gallery-sm-selection</a></li>
            
                <li><a href="../modules/gallery-sm-treeview.html">gallery-sm-treeview</a></li>
            
                <li><a href="../modules/gallery-sm-treeview-sortable.html">gallery-sm-treeview-sortable</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/sm-editor/js/editor-base.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*jshint expr:true, onevar:false */

Y.Node.DOM_EVENTS.paste = 1;

/**
Provides &#x60;Y.Editor.Base&#x60;, the core implementation of the SmugMug editor.

@module gallery-sm-editor
@submodule gallery-sm-editor-base
**/

/**
Base implementation of the SmugMug editor. Provides core editor functionality,
but no undo stack, keyboard shortcuts, etc.

@class Editor.Base
@constructor
@extends View
**/

var doc          = Y.config.doc,
    getClassName = Y.ClassNameManager.getClassName;

/**
Fired after this editor loses focus.

@event blur
**/
var EVT_BLUR = &#x27;blur&#x27;;

/**
Fired after this editor receives focus.

@event focus
**/
var EVT_FOCUS = &#x27;focus&#x27;;

/**
Fired after this editor is rendered.

@event render
**/
var EVT_RENDER = &#x27;render&#x27;;

/**
Fired when this editor&#x27;s selection changes.

@event selectionChange
@param {Range} prevRange Range that was previously selected, or &#x60;null&#x60; if there
    was no previous selection.
@param {Range} range Range that&#x27;s now selected, or &#x60;null&#x60; if the current
    selection is empty or outside the editor.
@param {Selection} selection Reference to this editor&#x27;s Selection instance.
**/
var EVT_SELECTION_CHANGE = &#x27;selectionChange&#x27;;

var EditorBase = Y.Base.create(&#x27;editorBase&#x27;, Y.View, [], {
    // -- Public Properties ----------------------------------------------------

    /**
    CSS class names used by this editor.

    @property {Object} classNames
    @param {String} cursor Class name used for a placeholder node that
        represents the cursor position.
    @param {String} editor Class name used for the editor&#x27;s container.
    @param {String} input Class name used for the WYSIWYG YUI Editor frame that
        will receive user input.
    **/
    classNames: {
        cursor: getClassName(&#x27;sm-editor-cursor&#x27;, true),
        editor: getClassName(&#x27;sm-editor&#x27;, true),
        input : getClassName(&#x27;sm-editor-input&#x27;, true)
    },

    /**
    &#x60;Y.Selection&#x60; instance representing the current document selection.

    The selection object&#x27;s state always reflects the current selection, so it
    will update when the selection changes. If you need to retain the state of a
    past selection, hold onto a Range instance representing that selection.

    Also, beware: this selection object reflects the current selection in the
    entire browser document, not just within this editor.

    @property {Selection} selection
    **/

    /**
    Hash of boolean commands supported by this editor. A boolean command is
    one that does not require a value. Executing this command will toggle
    the currently set value.

    Names should correspond with valid &#x60;execCommand()&#x60; command names.

    @property {Object} boolCommands
    **/
    boolCommands: {
        bold     : true,
        italic   : true,
        underline: true,
        justifyCenter: true,
        justifyFull: true,
        justifyLeft: true,
        justifyRight: true
    },

    // -- Protected Properties -------------------------------------------------

    // -- Lifecycle ------------------------------------------------------------

    initializer: function () {
        this.selection  = new Y.Selection();
        this.selectors  = {};

        this._cursorHTML = &#x27;&lt;span class=&quot;&#x27; + this.classNames.cursor + &#x27;&quot;&gt;&lt;/span&gt;&#x27;;

        Y.Object.each(this.classNames, function (name, key) {
            this.selectors[key] = &#x27;.&#x27; + name;
        }, this);

        this._attachEvents();
    },

    destructor: function () {
        this._detachEvents();

        this.selection = null;
    },

    // -- Public Methods -------------------------------------------------------

    /**
    Removes focus from this editor.

    @method blur
    @chainable
    **/
    blur: function () {
        if (this._inputNode) {
            this._inputNode.blur();
        }

        return this;
    },

    /**
    Gets and/or sets the value of the specified editor command.

    See &lt;https://developer.mozilla.org/en-US/docs/Rich-Text_Editing_in_Mozilla&gt;
    for a list of possible commands.

    @method command
    @param {String|Function} name Command name or function to execute. By
        default functions will execute in the editor context. Use Y.bind
        to provide a different execution context.
    @param {*} [value*] Command value or 0..n arguments to pass
        to the command function. Use the special value &#x27;toggle&#x27; to toggle a
        boolean command (like &#x27;bold&#x27;) to the opposite of its current state.
    @return {*} Value of the specified command or return value of the
        supplied function.
    **/
    command: function (name, value) {
        var args = Y.Array(arguments, 1, true),
            retVal;

        this.focus();

        if (typeof name === &#x27;function&#x27;) {
            retVal = name.apply(this, args);
        } else {
            value = args.shift();

            if (typeof value !== &#x27;undefined&#x27;) {
                this._execCommand(name, value);
            }

            retVal = this._queryCommandValue(name);
        }

        this._updateSelection({force: true});

        return retVal;
    },

    /**
    Decreases the font size of the current selection (if possible).

    @method decreaseFontSize
    @chainable
    **/
    decreaseFontSize: function () {
        var newSize = parseInt(this.command(&#x27;fontSize&#x27;), 10) - 1;

        if (newSize &gt; 0) {
            this.command(&#x27;fontSize&#x27;, &#x27;&#x27; + newSize);
        }

        return this;
    },

    /**
    Focuses this editor.

    @method focus
    @chainable
    **/
    focus: function () {
        if (this._inputNode) {
            this._inputNode.focus();
        }

        return this;
    },

    /**
    Increases the font size of the current selection (if possible).

    @method increaseFontSize
    @chainable
    **/
    increaseFontSize: function () {
        var newSize = parseInt(this.command(&#x27;fontSize&#x27;), 10) + 1;

        // currently only webkit supports size 7 (xxx-large), so keep
        // it under 7 for compatibility
        if (newSize &lt; 7) {
            this.command(&#x27;fontSize&#x27;, &#x27;&#x27; + newSize);
        }

        return this;
    },

    /**
    Inserts the specified _html_ at the current selection point, deleting the
    current selection if there is one.

    @method insertHTML
    @param {HTML|HTMLElement|Node} html HTML to insert, in the form of an HTML
        string, HTMLElement, or Node instance.
    @return {Node} Node instance representing the inserted HTML.
    **/
    insertHTML: function (html) {
        var node      = typeof html === &#x27;string&#x27; ? Y.Node.create(html) : html,
            selection = this.selection,
            range     = selection.range();

        if (!range) {
            return;
        }

        node = range.deleteContents().insertNode(node);
        range.collapse();

        selection.select(range);

        return node;
    },

    /**
    Inserts the specified plain _text_ at the current selection point, deleting
    the current selection if there is one.

    @method insertText
    @param {String} text Text to insert.
    @return {Node} Node instance representing the inserted text node.
    **/
    insertText: function (text) {
        return this.insertHTML(doc.createTextNode(text));
    },

    /**
    Renders this editor into its container and appends the container to the
    document if necessary.

    @method render
    @chainable
    **/
    render: function () {
        var container  = this.get(&#x27;container&#x27;),
            inputNode  = container.one(this.selectors.input);

        container.addClass(this.classNames.editor);

        if (!inputNode) {
            inputNode = container.appendChild(&#x27;&lt;div/&gt;&#x27;)
                                 .addClass(this.classNames.input);
        }

        var html = this.get(&#x27;html&#x27;),
            text = this.get(&#x27;text&#x27;);

        if (html) {
            inputNode.setHTML(html);
        } else if (text) {
            inputNode.set(&#x27;text&#x27;, text);
        }

        inputNode.set(&#x27;contentEditable&#x27;, true);

        this._inputNode = inputNode;
        this._rendered  = true;

        this._updateSelection({silent: true});

        this.fire(EVT_RENDER);

        return this;
    },

    // -- Protected Methods ----------------------------------------------------

    /**
    Attaches editor events.

    @method _attachEvents
    @protected
    **/
    _attachEvents: function () {
        if (this._events) {
            return;
        }

        var container = this.get(&#x27;container&#x27;),
            selectors = this.selectors;

        this._events = [
            container.delegate(&#x27;blur&#x27;,  this._onBlur,  selectors.input, this),
            container.delegate(&#x27;copy&#x27;,  this._onCopy,  selectors.input, this),
            container.delegate(&#x27;cut&#x27;,  this._onCut,  selectors.input, this),
            container.delegate(&#x27;dblclick&#x27;, this._onDblClick, selectors.input, this),
            container.delegate(&#x27;focus&#x27;, this._onFocus, selectors.input, this),
            container.delegate(&#x27;paste&#x27;, this._onPaste, selectors.input, this)
        ];
    },

    /**
    Detaches editor events.

    @method _detachEvents
    @protected
    **/
    _detachEvents: function () {
        if (this._events) {
            new Y.EventHandle(this._events).detach();
            this._events = null;
        }
    },

    /**
    Wrapper for native the native &#x60;execCommand()&#x60; that verifies that the command
    is valid in the current state and normalizes boolean/toggleable values.

    @method _execCommand
    @param {String} name Command name.
    @param {Boolean|String} value Command value.
    @protected
    **/
    _execCommand: function (name, value) {
        if (!doc.queryCommandEnabled(name)) {
            Y.log(&#x27;Command is not currently allowed: &#x27; + name, &#x27;warn&#x27;, &#x27;sm-editor&#x27;);
            return;
        }

        if (this.boolCommands[name]) {
            // Only execute the command if the desired state differs from the
            // current state, or the desired state is &#x27;toggle&#x27;, indicating that
            // the command should be toggled regardless of its current state.
            if (value === &#x27;toggle&#x27; || value !== this._queryCommandValue(name)) {
                doc.execCommand(name, false, null);
            }
        } else {
            doc.execCommand(name, false, value);
        }
    },

    /**
    Getter for the &#x60;html&#x60; attribute.

    @method _getHTML
    @param {HTML} value Internal value.
    @return {HTML} HTML.
    @protected
    **/
    _getHTML: function (value) {
        return this._rendered ? this._inputNode.getHTML() : value;
    },

    /**
    Getter for the &#x60;text&#x60; attribute.

    @method _getText
    @param {String} value Internal value.
    @return {String} Text.
    @protected
    **/
    _getText: function (value) {
        return this._rendered ? this._inputNode.get(&#x27;text&#x27;) : value;
    },

    /**
    Inserts a &#x60;&lt;span&gt;&#x60; at the current selection point containing a preformatted
    tab character.

    @method _insertTab
    @protected
    **/
    _insertTab: function () {
        this.insertHTML(&#x27;&lt;span style=&quot;white-space:pre;&quot;&gt;\t&lt;/span&gt;&#x27;);
    },

    /**
    Wrapper for the native &#x60;queryCommandState()&#x60; and &#x60;queryCommandValue()&#x60;
    methods that uses the appropriate method for the given command type.

    @method _queryCommandValue
    @param {String} name Command name.
    @return {Boolean|String} Command value.
    @protected
    **/
    _queryCommandValue: function (name) {
        return this.boolCommands[name] ?
            !!doc.queryCommandState(name) : doc.queryCommandValue(name);
    },

    /**
    Setter for the &#x60;html&#x60; attribute.

    @method _setHTML
    @param {HTML} value HTML.
    @return {HTML} HTML.
    @protected
    **/
    _setHTML: function (value) {
        if (this._rendered) {
            this._inputNode.setHTML(value);
        }

        return value;
    },

    /**
    Setter for the &#x60;text&#x60; attribute.

    @method _setText
    @param {String} value Text.
    @return {String} Text.
    @protected
    **/
    _setText: function (value) {
        if (this._rendered) {
            this._inputNode.set(&#x27;text&#x27;, value);
        }

        return value;
    },

    /**
    Refreshes the editor&#x27;s internal knowledge of the current document selection
    state and fires a &#x60;selectionChange&#x60; event if the selection has changed since
    it was last refreshed.

    @method _updateSelection
    @param {Object} [options] Options.
        @param {Boolean} [options.force=false] If &#x60;true&#x60;, the internal selection
            state will be updated regardless of if the selection changed.
        @param {Boolean} [options.silent=false] If &#x60;true&#x60;, the &#x60;selectionChange&#x60;
            event will be suppressed.
    @protected
    **/
    _updateSelection:  function (options) {
        var prevRange = this._selectedRange || null,
            newRange  = this.selection.range() || null,
            force     = options &amp;&amp; options.force,
            silent    = options &amp;&amp; options.silent;

        if (!force &amp;&amp; (
                newRange === prevRange || (
                    prevRange &amp;&amp;
                    prevRange.isEquivalent(newRange) &amp;&amp;
                    prevRange.toHTML() === newRange.toHTML()
                )
            )
        ) {
            return;
        }

        this._selectedRange = newRange;

        // Only fire an event if options.silent is falsy and the new range is
        // either null or is entirely inside this editor.
        if (!silent &amp;&amp; (!newRange || newRange.isInsideNode(this._inputNode))) {
            this.fire(EVT_SELECTION_CHANGE, {
                prevRange: prevRange,
                range    : newRange,
                selection: this.selection
            });
        }
    },

    // -- Protected Event Handlers ---------------------------------------------

    /**
    Handles &#x60;blur&#x60; events on the editor.

    @method _onBlur
    @protected
    **/
    _onBlur: function () {
        if (!this._rendered) {
            return;
        }

        clearInterval(this._selectionMonitor);

        this.fire(EVT_BLUR);
    },

    /**
    Handles &#x60;copy&#x60; events on the editor.

    @method _onCopy
    @param {EventFacade} e
    @protected
    **/
    _onCopy: function (e) {
        var clipboard = e._event.clipboardData || window.clipboardData,
            range = this.selection.range(),
            contents = range.cloneContents().getHTML();

        e.preventDefault();

        try {
            // IE doesn&#x27;t support mime types
            clipboard.setData(&#x27;text/html&#x27;, contents);
            clipboard.setData(&#x27;text/plain&#x27;, contents);
        } catch (err) {
            clipboard.setData(&#x27;text&#x27;, contents);
        }
    },

    /**
    Handles &#x60;cut&#x60; events on the editor.

    @method _onCut
    @param {EventFacade} e
    @protected
    **/
    _onCut: function (e) {
        var clipboard = e._event.clipboardData || window.clipboardData,
            range = this.selection.range(),

            // note the &#x60;expand()&#x60;. this prevents any empty nodes
            // being left after &#x60;extractContents()&#x60;
            contents = range.expand().extractContents().getHTML();

        e.preventDefault();

        this.selection.select(range);

        try {
            // IE doesn&#x27;t support mime types
            clipboard.setData(&#x27;text/html&#x27;, contents);
            clipboard.setData(&#x27;text/plain&#x27;, contents);
        } catch (err) {
            clipboard.setData(&#x27;text&#x27;, contents);
        }
    },

    /**
    Handles &#x60;dblclick&#x60; events on the editor.

    @method _onDblClick
    @protected
    **/
    _onDblClick: function() {
        var range = this.selection.range();

        this.selection.select(range.shrink({trim: true}));
    },

    /**
    Handles &#x60;focus&#x60; events on the editor.

    @method _onFocus
    @protected
    **/
    _onFocus: function () {
        var self = this;

        if (!this._rendered) {
            return;
        }

        // restore the previously selected range
        if (this._selectedRange) {
            this.selection.select(this._selectedRange);
        }

        this._updateSelection();

        clearInterval(this._selectionMonitor);

        this._selectionMonitor = setInterval(function () {
            self._updateSelection();
        }, 200);

        this.fire(EVT_FOCUS);
    },

    /**
    Handles &#x60;paste&#x60; events on the editor.

    @method _onPaste
    @protected
    **/
    _onPaste: function () {
        // TODO: handle paste events!
    }
}, {
    ATTRS: {
        /**
        HTML content of this editor.

        @attribute {HTML} html
        @default &#x27;&#x27;
        **/
        html: {
            getter: &#x27;_getHTML&#x27;,
            setter: &#x27;_setHTML&#x27;,
            value : &#x27;&#x27;
        },

        /**
        Form field name to use for the hidden &#x60;&lt;textarea&gt;&#x60; that contains the raw
        output of the editor in the configured output format. This name will
        only be used if the output node doesn&#x27;t already have a name when the
        editor is rendered.

        You may need to customize this if you plan to use the editor in a form
        that will be submitted to a server.

        @attribute {String} outputName
        @default &#x27;editor&#x27;
        @initOnly
        **/
        outputName: {
            value    : &#x27;editor&#x27;,
            writeOnce: &#x27;initOnly&#x27;
        },

        /**
        Text content of this editor, with no HTML.

        @attribute {String} text
        @default &#x27;&#x27;
        **/
        text: {
            getter: &#x27;_getText&#x27;,
            setter: &#x27;_setText&#x27;,
            value : &#x27;&#x27;
        }
    }
});

Y.namespace(&#x27;Editor&#x27;).Base = EditorBase;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
