YUI.add("gallery-sm-focusmanager",function(e,t){function n(){n.superclass.constructor.apply(this,arguments)}e.extend(n,e.Plugin.Base,{keyCodeMap:{32:"space",33:"pgup",34:"pgdown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down"},preventDefaultMap:{down:1,end:1,home:1,left:1,pgdown:1,pgup:1,right:1,space:1,up:1},initializer:function(e){this._host=e.host,this._attachEvents(),this.refresh()},destructor:function(){this._detachEvents()},ascend:function(){var e=this._getActiveContainer(),t=this._host,n;return e===t?null:(n=e.ancestor(this.get("itemSelector"),!1,function(e){return e===t}),this.set("activeItem",n,{src:"ascend"}),n)},descend:function(){var e=this.get("activeItem"),t=this.get("anchoredContainerSelector");if(!t||!e)return null;var n=e.one(t);return n?this.first({container:n}):null},first:function(e){e||(e={});var t=e.container||this.get("host"),n=this.get("disabledSelector"),r=this.get("itemSelector"),i=t.one(this.get("anchoredItemSelector"));while(i&&n&&i.test(n))i=i.next(r);return e.silent||this.set("activeItem",i,{src:"first"}),i},last:function(e){e||(e={});var t=e.container||this._host,n=this.get("disabledSelector"),r=t.all(this.get("anchoredItemSelector")),i=r.pop();while(i&&n&&i.test(n))i=r.pop();return e.silent||this.set("activeItem",i,{src:"last"}),i},next:function(t){t||(t={});var n=this.get("activeItem");if(!n)return null;var r=this.get("disabledSelector"),i=this.get("itemSelector"),s=n.next(i);while(s&&r&&s.test(r))s=s.next(i);return s?t.silent||this.set("activeItem",s,{src:"next"}):this.get("circular")&&(s=this.first(e.merge(t,{container:this._getActiveContainer(n)}))),s||n},previous:function(t){t||(t={});var n=this.get("activeItem");if(!n)return null;var r=this.get("disabledSelector"),i=this.get("itemSelector"),s=n.previous(i);while(s&&r&&s.test(r))s=s.previous(i);return s?t.silent||this.set("activeItem",s,{src:"previous"}):this.get("circular")&&(s=this.last(e.merge(t,{container:this._getActiveContainer(n)}))),s||n},refresh:function(e){var t=this.get("activeItem"),n=this.get("disabledSelector"),r=this.get(e?"anchoredItemSelector":"itemSelector");return(e||this._host).all(r).each(function(e){n&&e.test(n)?e.removeAttribute("tabIndex"):e.set("tabIndex",e===t?0:-1)}),this},_attachEvents:function(){var e=this._host;this._events=[e.on("keydown",this._onKeyDown,this),e.after("blur",this._afterBlur,this),e.after("focus",this._afterFocus,this),this.after({activeItemChange:this._afterActiveItemChange})]},_detachEvents:function(){(new e.EventHandle(this._events)).detach()},_getActiveContainer:function(e){var t=this.get("containerSelector"),n=this._host,r;return t?(e||(e=this.get("activeItem")),e?(r=e.ancestor(t,!1,function(e){return e===n}),r||n):n):n},_getAnchoredContainerSelector:function(e){if(e)return e;var t=this.get("containerSelector");return t?">"+t:null},_getAnchoredItemSelector:function(e){return e?e:">"+this.get("itemSelector")},_afterActiveItemChange:function(e){var t=e.newVal,n=e.prevVal;n&&n.set("tabIndex",-1),t&&(t.set("tabIndex",0),this.get("focused")&&t.focus())},_afterBlur:function(){this._set("focused",!1)},_afterFocus:function(e){var t=e.target;this._set("focused",!0),t!==this._host&&t.test(this.get("itemSelector"))&&this.set("activeItem",t,{src:"focus"})},_onKeyDown:function(e){if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;var t=this.keyCodeMap[e.keyCode]||e.keyCode,n=this.get("keys"),r=n[t]||n[e.keyCode];r&&(this.preventDefaultMap[t]&&e.preventDefault(),typeof r=="string"?this[r].call(this):r.call(this))}},{NAME:"focusManager",NS:"focusManager",ATTRS:{activeItem:{valueFn:function(){return this.first()}},anchoredContainerSelector:{getter:"_getAnchoredContainerSelector"},anchoredItemSelector:{getter:"_getAnchoredItemSelector"},circular:{value:!0},containerSelector:{},disabledSelector:{value:'[aria-disabled="true"], [aria-hidden="true"], [disabled]'},focused:{readOnly:!0,value:!1},itemSelector:{value:"*"},keys:{cloneDefaultValue:"shallow",value:{down:"next",left:"ascend",right:"descend",up:"previous"}}}}),e.namespace("Plugin").FocusManager=n},"@VERSION@",{requires:["event-focus","node-pluginhost","plugin","selector-css3"]});
