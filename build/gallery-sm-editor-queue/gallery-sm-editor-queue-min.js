YUI.add("gallery-sm-editor-queue",function(e,t){(function(){var t=e.Base.create("editorStyle",e.Base,[],{queueKeyCommands:{down:{fn:"_clearCommandQueue",allowDefault:!0},end:{fn:"_clearCommandQueue",allowDefault:!0},esc:{fn:"_clearCommandQueue",allowDefault:!0},home:{fn:"_clearCommandQueue",allowDefault:!0},left:{fn:"_clearCommandQueue",allowDefault:!0},pgdown:{fn:"_clearCommandQueue",allowDefault:!0},pgup:{fn:"_clearCommandQueue",allowDefault:!0},right:{fn:"_clearCommandQueue",allowDefault:!0},tab:{fn:"_clearCommandQueue",allowDefault:!0},up:{fn:"_clearCommandQueue",allowDefault:!0}},initializer:function(){this.keyCommands&&(this.keyCommands=e.merge(this.keyCommands,this.queueKeyCommands)),this._attachQueueEvents()},destructor:function(){this._detachQueueEvents()},_attachQueueEvents:function(){if(this._queueEvents)return;var t=this.get("container");this._queueEvents=[t.delegate("keypress",this._onKeyPress,this.selectors.input,this),e.Do.before(this._queueDoBeforeCommand,this,"command",this),e.Do.before(this._queueDoBeforeQuery,this,"query",this)]},_clearCommandQueue:function(){this._commandQueue=null},_detachQueueEvents:function(){this._queueEvents&&((new e.EventHandle(this._queueEvents)).detach(),this._queueEvents=null)},_flushCommandQueue:function(){if(!this._commandQueue)return;var t=e.merge(this._commandQueue);e.Object.each(t,function(e,t){this.command(t,e)},this),this._clearCommandQueue()},_queueCommand:function(t,n){var r=this.commands[t];return this._commandQueue||(this._commandQueue={}),r.style&&e.Lang.isValue(r.style.value)&&(n=this._commandQueue[t]?"":r.style.value),this._commandQueue[t]=n,n},_onKeyPress:function(t){if(t.metaKey)return;var n=this.selection,r=n.range(),i;r.shrink().isCollapsed()&&this._commandQueue?(t.preventDefault(),i=r.insertNode(e.Node.create(String.fromCharCode(t.charCode))),n.select(r.selectNode(i)),this._flushCommandQueue(),n.select(r.selectNode(i).shrink().collapse())):this._clearCommandQueue()},_queueDoBeforeCommand:function(t,n){var r=this.styleCommands[t],i,s;if(r&&"block"!==r.type){i=this.selection.range();if(i&&i.isCollapsed())return s=this._queueCommand(t,n),this._updateSelection({force:!0}),new e.Do.Halt("Editor.Queue prevented command",s)}else this._clearCommandQueue()},_queueDoBeforeQuery:function(t){var n=this._commandQueue&&this._commandQueue[t],r=this.styleCommands[t];if(r&&e.Lang.isValue(n))return e.Lang.isValue(r.style.value)&&(n=n===r.style.value),new e.Do.Halt("Editor.Queue prevented query",n)}});e.namespace("Editor").Queue=t})()},"@VERSION@",{requires:["base-build","event-custom","gallery-sm-editor-base","gallery-sm-editor-keys","node-event-delegate"]});
