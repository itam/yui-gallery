YUI.add("gallery-sm-editor-undo",function(e,t){var n=e.Base.create("editorUndo",e.Base,[],{undoKeyCommands:{"ctrl+z":"undo","ctrl+shift+z":"redo",backspace:{fn:"_addUndo",allowDefault:!0},"ctrl+x":{fn:"_addUndo",allowDefault:!0},"ctrl+v":{fn:"_addUndo",allowDefault:!0},"delete":{fn:"_addUndo",allowDefault:!0},enter:{fn:"_addUndo",allowDefault:!0,async:!0},".":{fn:"_addUndo",allowDefault:!0,async:!0},"shift+!":{fn:"_addUndo",allowDefault:!0,async:!0},"shift+?":{fn:"_addUndo",allowDefault:!0,async:!0}},initializer:function(){this.keyCommands&&(this.keyCommands=e.merge(this.keyCommands,this.undoKeyCommands)),this._redoStack=[],this._undoStack=[],e.Do.before(this._addUndo,this,"insertHTML",this),e.Do.before(this._beforeExecCommand,this,"_execCommand",this),this._attachUndoEvents()},destructor:function(){this._detachUndoEvents(),this._redoStack=null,this._undoStack=null},redo:function(){var t=this._redoStack.pop();if(typeof t!="string")return this;if(t.replace(this._cursorHTML,"")===this._inputNode.getHTML())return this.redo();this._addUndo(),this._inputNode.setHTML(t);var n=this._inputNode.one(this.selectors.cursor);if(n){var r=new e.Range;r.startNode(n,"after"),this.selection.select(r),n.remove(!0)}return this},undo:function(){var t=this._undoStack.pop();if(typeof t!="string")return this;if(t.replace(this._cursorHTML,"")===this._inputNode.getHTML())return this.undo();this._addRedo(),this._inputNode.setHTML(t);var n=this._inputNode.one(this.selectors.cursor);if(n){var r=new e.Range;r.startNode(n,"after"),this.selection.select(r),n.remove(!0)}return this},_addUndo:function(){var t=this.selection.range(),n=this._undoStack,r;t&&(r=t.insertNode(e.Node.create(this._cursorHTML)),this.selection.select(t));var i=this._inputNode.getHTML();r&&r.remove(!0),n.push(i)>this.get("undoLevels")&&n.shift()},_addRedo:function(){var t=this.selection.range(),n=this._redoStack,r;t&&(r=t.insertNode(e.Node.create(this._cursorHTML)),this.selection.select(t));var i=this._inputNode.getHTML();r&&r.remove(!0),n.push(i)>this.get("undoLevels")&&n.shift()},_attachUndoEvents:function(){if(this._undoEvents)return;this._undoEvents=[this.after("render",this._afterRender)]},_beforeExecCommand:function(e){/^(?:redo|undo)$/i.test(e)||this._addUndo()},_detachUndoEvents:function(){this._undoEvents&&((new e.EventHandle(this._undoEvents)).detach(),this._undoEvents=null)},_afterRender:function(){this._addUndo()}},{ATTRS:{undoLevels:{value:20}}});e.namespace("Editor").Undo=n},"@VERSION@",{requires:["base-build","event-custom","gallery-sm-editor-base","gallery-sm-editor-keys","gallery-sm-range"]});
